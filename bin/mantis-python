#!/usr/bin/python
from SOAPpy import WSDL, faultType

import argparse;

def add_note(arg):
    mantis = WSDL.Proxy(arg.wsdl);
    mantis.mc_issue_note_add(
        arg.username,
        arg.password,
        arg.issue_id,
        {'text': arg.note}
    )

parser = argparse.ArgumentParser()
parser.add_argument("-w", "--wsdl", default="http://mantis.smartisan.cn/api/soap/mantisconnect.php?wsdl")
parser.add_argument("-u", "--username")
parser.add_argument("-p", "--password")


subparsers = parser.add_subparsers()
parser_add_note = subparsers.add_parser("issue-add-note", help="add issue note")
parser_add_note.add_argument("-i", "--issue-id")
parser_add_note.add_argument("-n", "--note")
parser_add_note.set_defaults(command=add_note)

parser_get_issue = subparsers.add_parser("issue-get", help="get issue")
parser_get_issue.add_argument("-i", "--issue-id")
def get_issue(arg):
    mantis = WSDL.Proxy(arg.wsdl);
    print mantis.mc_issue_get(
        arg.username,
        arg.password,
        arg.issue_id,
    )

parser_get_issue.set_defaults(command=get_issue)

parser_get_filters = subparsers.add_parser("get-filter", help="get filters")
parser_get_filters.add_argument("--project")
def get_filter(arg):
    mantis = WSDL.Proxy(arg.wsdl)
    print mantis.mc_filter_get(
        arg.username,
        arg.password,
        arg.project
    )

parser_get_filters.set_defaults(command=get_filter)

parser_get_projects = subparsers.add_parser("get-projects", help="get projects")
def get_projects(arg):
    mantis = WSDL.Proxy(arg.wsdl)
    return mantis.mc_projects_get_user_accessible(
        arg.username,
        arg.password
    )

parser_get_projects.set_defaults(command=get_projects)

arg = parser.parse_args()
arg.command(arg)
