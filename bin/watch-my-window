#!/bin/bash

set -x
exec &> ~/tmp/watch-my-window.log
exec >> ~/today/watch-my-window.log

if ! screen-is-on; then
    echo "$(date): screen-locked"
    exit
fi

. ~/.renew-xauth

top_window=$(sawfish-top-window)


if [[ $top_window =~ Firefox ]]; then
    url=$(firefox-get-tab-url --no-with-xkeytool)
    echo "$(date): ${top_window} ($url)"
    if is-at-work &>/dev/null && [[ $url =~ weibo.com|www.newsmth.net ]]; then
        alarm -a "e ~/system-config/doc/projects/daily.org" 0m "You should not view weibo when at work!"
    fi
else
    echo "$(date): ${top_window}"
fi
