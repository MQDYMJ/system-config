#!/bin/bash

if test "$DEBUG"; then
    set -x
fi

whole_screen=

if test $(basename $0) = sawfish-get-screen-shot-whole; then
    whole_screen=-h
fi
rm /tmp/screen-exchange
command="hardcopy $whole_screen /tmp/screen-exchange"


sawfish-send-focused-window-event "C-z" ":" $(
    for n in $(seq 0 ${#command}); do
        if test "${command:n:1}" = " "; then
            echo SPC
        else
            echo "${command:n:1}"
        fi
    done ) RET

for x in $(seq 1 20); do
    if test -e /tmp/screen-exchange; then
        perl -ne '
        if (($. == 1 and ! m/./) .. m/./) {
            print if m/./;
        } else {
            print
        }' -i /tmp/screen-exchange
        cat /tmp/screen-exchange
        exit
    fi
    sleep .1
done
