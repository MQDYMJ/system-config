#!/bin/bash

# [[file:~/src/github/private-config/knuth-mode/sawfish-window-custom-menu.org::*%E6%9C%80%E7%BB%88%E7%9A%84%E7%89%88%E6%9C%AC%EF%BC%9A][the-ultimate-script]]

set -e

#!/bin/bash
top_window=$(sawfish-top-window)

declare -A window_operations

window_operations[kdenlive-fade-effects]="M-i e f"

window_operations[*-get-cursor-pos-in-window]=function
window_operations[*-get-current-window-size]=function

function get-current-window-size() {
    sawfish-client -e '(window-dimensions (input-focus))'
}

function get-cursor-pos-in-window() {
        sawfish-client -e "$(cat <<'EOFd4088284f710'
(let* ((pointer (query-pointer))
       (window-pos (window-position (input-focus)))
       (px (car pointer))
       (py (cdr pointer))
       (wx (car window-pos))
       (wy (cdr window-pos)))
  (cons (- px wx) (- py wy)))
EOFd4088284f710
)" | tr -d '().'
}

operations=$(
    for x in "${!window_operations[@]}"; do
        if [[ $x =~ ^$top_window- ]]; then
            echo "${x#$top_window-}"
        elif [[ $x =~ ^\*- ]]; then
            echo "${x#\*-}"
        fi
    done
          )

operation=$(EMACS=t select-args -o -p "What operation do you want for $top_window?" -- $operations)

if test "${window_operations[$top_window-$operation]}"; then
    for x in ${window_operations[$top_window-$operation]}; do
        sawfish-send-focused-window-event "$x"
    done
    exit
fi

if test "${window_operations[*-$operation]}"; then
    output=$($operation)
    bhj-notify "$operation" "output is $output"
fi

# Local Variables: #
# eval: (read-only-mode 1) #
# End: #

# the-ultimate-script ends here
