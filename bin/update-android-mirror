#!/bin/bash
set -ex

. ~/system-config/.bashrc
. ~/system-config/bin/set-ssh-agent


(
    cd ~/src/android-mirror/ || exit 0
    if ! is-tty-io; then
        (
            repo init -u s:qualcomm/platform/manifest.git -b sanfrancisco -m sfo-rom.xml
            repo sync -j8 -f -m icesky-rom.xml
            repo sync -j8 -f -m sfo-rom.xml
        ) || true
        (
            cd ~/src/android-mirror/kernel/msm.git || exit 0
            git fetch https://github.com/mirrors/linux
        ) || true
    fi

    export http_proxy=http://localhost:8888
    export https_proxy=http://localhost:8888
    repo-switch -u https://android.googlesource.com/platform/manifest -b master -m default.xml
    repo sync -j1 -f || true
)

#git clone --mirror --bare git://android.git.kernel.org/tools/repo.git
cd ~/src/android-mirror/git-repo.git
git fetch
echo ok, repo update complete
