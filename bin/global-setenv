#!/bin/bash
setenvs=$(declare -x -p | perl -ne "$(
cat <<'EOF3ca1586eb1f1'
# {%perl-mode%}
next unless m,^declare -x \w+="[^"]*"$,;
s,^declare -x ,(setenv ",;
s,=," ,;
s,$,),;
print
# {%/perl-mode%}
EOF3ca1586eb1f1

)")

lisp=$(
    cat <<'EOF2f77bccb9b66' |. .replace-%% --
; {%emacs-lisp-mode%}
(progn
  [%setenvs%])
; {%/emacs-lisp-mode%}
EOF2f77bccb9b66

)
echo "${lisp}" > ~/tmp/global-setenv.log
emacsclient -e "${lisp}"
sawfish-client -e "${lisp}"
