#!/bin/bash

alias less='less -i'
alias arping='sudo arping'
alias quilt="quilt --quiltrc=${HOME}/.quiltrc-dpkg"
alias dquilt="quilt --quiltrc=${HOME}/.quiltrc-dpkg"
alias aptitude='sudo aptitude'
alias umount='command sudo umount'
alias mplayer='mplayer -heartbeat-cmd "xscreensaver-command -deactivate"'
alias adb=my-adb
alias mplayer=mplayer.x

jcd() {
    # http://build1:8080/job/Daily-surabaya-dev-colombo-Vuserdebug-Onone/6/console
    local task=$(echo "$1"|perl -npe 's,.*/job/(.*?)/.*,$1,')
    local build=$(echo "$1"|perl -npe "s,.*/\Q$task\E/(\d+|lastFailedBuild).*,\$1,")
    cd /var/lib/jenkins/jobs/$task/builds/$build
}

mount() {
    if test $# = 0; then
        command mount
    else
        sudo mount "$@"
    fi
}

my-lunch () {
    alias lunch=my-lunch
    if (unalias lunch; test "$(type -t lunch)" = function); then
        (
            unalias lunch
            android-set-product "$@"
        )
        reset-env "alias lunch=my-lunch"
        unalias lunch
        if test "$#" != 0; then
            lunch "$@"
        else
            buildspec=$(lookup-file -e buildspec.mk || true)
            if test -e "$buildspec"; then
                local product=$(cat "$buildspec" | perl -ne 'print $1 if m,^\QTARGET_PRODUCT?=\E(.*),')
                local variant=$(cat "$buildspec" | perl -ne 'print $1 if m,^\QTARGET_BUILD_VARIANT?=\E(.*),')
            fi
            if test "$product" -a "$variant"; then
                lunch "$product"-"$variant"
            fi
        fi
        alias lunch=my-lunch
    elif test "$(type -a -t lunch)" = alias; then
        (
            unalias lunch
            android-set-product "$@"
        )
    else
        reset-env "alias lunch=my-lunch"
        unalias lunch
        lunch "$@"
        alias lunch=my-lunch
    fi
}

alias lunch=my-lunch

if test -e ~/.config/system-config/vim-is-evil; then
    alias vi=e
    alias vim=e
    if test "$(lsb_release -cs)" = trusty; then
        export PATH=~/external/local/emacs25u/bin:$PATH
    elif test -d ~/external/local/emacs25-$(lsb_release -c -s); then
        export PATH=~/external/local/emacs25-$(lsb_release -c -s)/bin:$PATH
    fi
fi

SETX() {
    set -x;
    export SHELLOPTS
}
