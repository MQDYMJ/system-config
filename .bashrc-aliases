#!/bin/bash

alias arping='sudo arping'
alias quilt="quilt --quiltrc=${HOME}/.quiltrc-dpkg"
alias dquilt="quilt --quiltrc=${HOME}/.quiltrc-dpkg"
alias aptitude='sudo aptitude'
alias umount='command sudo umount'
alias mplayer='mplayer -heartbeat-cmd "xscreensaver-command -deactivate"'
alias adb=my-adb

jcd() {
    # http://build1:8080/job/Daily-surabaya-dev-colombo-Vuserdebug-Onone/6/console
    local task=$(echo "$1"|perl -npe 's,.*/job/(.*?)/.*,$1,')
    local build=$(echo "$1"|perl -npe "s,.*/\Q$task\E/(\d+|lastFailedBuild).*,\$1,")
    cd /var/lib/jenkins/jobs/$task/builds/$build
}

mount() {
    if test $# = 0; then
        command mount
    else
        sudo mount "$@"
    fi
}

if test -e ~/.config/system-config/vim-is-evil; then
    alias vi=e
    alias vim=e
    if test "$(lsb_release -cs)" = trusty; then
        export PATH=~/external/local/emacs25u/bin:$PATH
    elif test -d ~/external/local/emacs25-$(lsb_release -c -s); then
        export PATH=~/external/local/emacs25-$(lsb_release -c -s)/bin:$PATH
    fi
fi

SETX() {
    set -x;
    export SHELLOPTS
}

## start code-generator "^\\s *#+\\s *"
# for x in choosetype chooseproduct choosecombo lunch tapas; do
#     cat <<EOF
# function $x() {
#     echo android env not setup yet
# }
# alias $x=my-$x; unalias $x
# function my-$x() {
#     function export() {
#         my_export "\$@"
#     }
#     builtin export -f export
#     $x "\$@"
#     unset export
# }
# alias $x=my-$x
# EOF
# done
## end code-generator
## start generated code
function choosetype() {
    echo android env not setup yet
}
alias choosetype=my-choosetype; unalias choosetype
function my-choosetype() {
    function export() {
        my_export "$@"
    }
    builtin export -f export
    choosetype "$@"
    unset export
}
alias choosetype=my-choosetype
function chooseproduct() {
    echo android env not setup yet
}
alias chooseproduct=my-chooseproduct; unalias chooseproduct
function my-chooseproduct() {
    function export() {
        my_export "$@"
    }
    builtin export -f export
    chooseproduct "$@"
    unset export
}
alias chooseproduct=my-chooseproduct
function choosecombo() {
    echo android env not setup yet
}
alias choosecombo=my-choosecombo; unalias choosecombo
function my-choosecombo() {
    function export() {
        my_export "$@"
    }
    builtin export -f export
    choosecombo "$@"
    unset export
}
alias choosecombo=my-choosecombo
function lunch() {
    echo android env not setup yet
}
alias lunch=my-lunch; unalias lunch
function my-lunch() {
    function export() {
        my_export "$@"
    }
    builtin export -f export
    lunch "$@"
    unset export
}
alias lunch=my-lunch
function tapas() {
    echo android env not setup yet
}
alias tapas=my-tapas; unalias tapas
function my-tapas() {
    function export() {
        my_export "$@"
    }
    builtin export -f export
    tapas "$@"
    unset export
}
alias tapas=my-tapas

## end generated code

function my_export() {
    if [[ $1 =~ ^PROMPT_COMMAND= ]]; then
        if test -z "$PROMPT_COMMAND" -o "$PROMPT_COMMAND" != cd_record; then
            builtin export "$@"
        else
            BHJ_PWD=
            unset -f export >/dev/null 2>&1
        fi
    else
        builtin export "$@"
    fi
}
